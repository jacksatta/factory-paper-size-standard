export default { port:null, writer:null, async connect(cfg){ if(!('serial' in navigator)) throw new Error('Web Serial unsupported'); this.port=await navigator.serial.requestPort(); await this.port.open({baudRate:(cfg&&cfg.baud)||115200}); this.writer=this.port.writable.getWriter(); return {ok:true}; }, async sendCommand(t,c,p){ if(!this.writer) return {ok:false}; const msg=JSON.stringify({target:t,command:c,params:p})+'\n'; await this.writer.write(new TextEncoder().encode(msg)); return {ok:true}; }, async getStatus(){ return {ok:true}; }, async disconnect(){ try{ if(this.writer){ this.writer.releaseLock(); } if(this.port){ await this.port.close(); } }catch(e){} this.port=this.writer=null; return {ok:true}; } };